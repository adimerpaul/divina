import{_ as k,c as q,o as p,w as r,a as s,b as e,Q as b,e as _,f as c,aq as V,a5 as m,a6 as v,a7 as w,t as d,a1 as D,d as Q,Z as u,at as h,a8 as F,h as E}from"./index-DQChmr6p.js";import{Q as S}from"./QPagination-CxQD7Ddn.js";import{Q as y}from"./QImg-DOY6ALTi.js";import{Q as P}from"./QMarkupTable-D64y_U9g.js";import{Q as U}from"./QForm-BVcm-P0w.js";import{Q as B}from"./QSpace-CizLRtMD.js";import{Q as C}from"./QSelect-Dhk9RMMV.js";import{Q as G}from"./QPage-rg7CFRjY.js";import{I}from"./Imprimir-e5_Ag4nd.js";import"./format-BvkBI9bc.js";import"./QChip-Bvabq3rY.js";import"./QMenu-IhoyNysE.js";import"./_commonjsHelpers-Bx2EM-6T.js";import"./moment-C5S46NFB.js";const N={name:"ComprasCreate",data(){return{loading:!1,compraDialog:!1,productos:[],productosSearch:"",productosCompras:[],proveedores:[],proveedor:null,compra:{nit:"",nombre:"",tipo_pago:"Efectivo"},pagination:{page:1,rowsPerPage:24,rowsNumber:0}}},computed:{totalCompra(){let a=0;return this.productosCompras.forEach(o=>{a+=o.cantidad*o.precio}),parseFloat(a).toFixed(2)}},methods:{recuperarPedido(){this.$q.dialog({title:"Recuperar pedido",message:"Ingrese el ID del pedido",prompt:{model:"",type:"text",isValid:a=>!!a||"Campo requerido"},persistent:!0,cancel:!0,ok:{label:"Recuperar",color:"primary"}}).onOk(a=>{this.loading=!0,this.$axios.get("recuperarPedido",{params:{id:a}}).then(o=>{if(!o.data.detalles||o.data.detalles.length===0){this.$alert.error("No se encontraron productos en el pedido");return}o.data.detalles.forEach(g=>{const f=g.producto,n=this.productosCompras.find(l=>l.producto_id===f.id);n?n.cantidad+=1:this.productosCompras.push({producto_id:f.id,cantidad:parseInt(g.cantidad),precio:"",lote:"",fecha_vencimiento:"",producto:f,factor:1.25})})}).catch(o=>{console.error("Error recuperando pedido:",o)}).finally(()=>{this.loading=!1})})},updatePrecioVenta(a){const o=Math.ceil(a.precio*a.factor);a.precio_venta=o},productosGet(){this.loading=!0,this.$axios.get("productos",{params:{search:this.productosSearch,page:this.pagination.page,per_page:this.pagination.rowsPerPage}}).then(a=>{this.productos=a.data.data,this.pagination.rowsNumber=a.data.total}).catch(a=>{console.error("Error cargando productos:",a)}).finally(()=>{this.loading=!1})},addProducto(a){const o=this.productosCompras.find(g=>g.producto_id===a.id);o?o.cantidad+=1:this.productosCompras.push({producto_id:a.id,cantidad:1,precio:"",lote:"",fecha_vencimiento:"",producto:a,factor:1.25})},clickDialogCompra(){if(this.productosCompras.length===0){this.$alert.error("Debe agregar al menos un producto");return}if(this.productosCompras.filter(o=>!o.precio).length>0){this.$alert.error("Todos los productos deben tener precio unitario");return}this.compraDialog=!0},buscarProveedor(){this.compra.nit&&(this.loading=!0,this.$axios.post("searchProveedor",{nit:this.compra.nit}).then(a=>{a.data?.nombre&&(this.compra.nombre=a.data.nombre)}).catch(a=>{console.warn("Proveedor no encontrado",a)}).finally(()=>{this.loading=!1}))},submitCompra(){this.loading=!0;const a={tipo_pago:this.compra.tipo_pago,proveedor_id:this.proveedor.id,nro_factura:this.compra.nro_factura,productos:this.productosCompras,agencia:this.compra.agencia};this.$axios.post("compras",a).then(o=>{this.$alert.success("Compra registrada correctamente"),this.compraDialog=!1,this.productosCompras=[],I.reciboCompra(o.data),this.productosGet(),this.compra={nit:"",nombre:"",tipo_pago:"Efectivo"},this.proveedor=null}).catch(o=>{console.error("Error registrando compra:",o),this.$alert.error("Error al registrar la compra")}).finally(()=>{})},proveedoresGet(){this.$axios.get("proveedores").then(a=>{this.proveedores=a.data}).catch(a=>{console.error("Error cargando proveedores:",a)}).finally(()=>{})}},mounted(){this.productosGet(),this.proveedoresGet()}},T={class:"row"},M={class:"col-12 col-md-5 q-pa-xs"},K={class:"flex flex-center"},R={class:"row"},z={class:"col-6 col-md-2"},L={class:"absolute-bottom text-center",style:{padding:"0",margin:"0"}},j={style:{"max-width":"190px","line-height":"0.9"}},$={style:{display:"flex","justify-content":"space-between"}},A={class:"text-bold bg-orange text-black border"},O={class:"col-12 col-md-7 q-pa-xs"},Z={style:{display:"flex","align-items":"center","justify-content":"space-between"}},H={class:"pm-none",style:{display:"flex","align-items":"center"}},J={style:{"max-width":"120px","wrap-option":"warp","line-height":"0.9"}},W={class:"pm-none"},X=["onUpdate:modelValue","onKeyup","onUpdate"],Y={class:"pm-none"},ee=["onUpdate:modelValue","onKeyup","onUpdate"],te={class:"text-right pm-none"},oe={class:"pm-none"},ae=["onUpdate:modelValue","onKeyup","onUpdate"],se={class:"text-right pm-none text-bold"},ne={class:"text-right pm-none"},ie={class:"pm-none"},le=["onUpdate:modelValue"],re={class:"pm-none"},de=["onUpdate:modelValue"],pe={class:"pm-none"},ce=["onUpdate:modelValue"],me={class:"pm-none text-right"},ue={class:"text-right"},he={class:"row"},ge={class:"col-12 col-md-6 q-pa-xs"},xe={class:"col-12 col-md-6 q-pa-xs"},fe={class:"col-12 col-md-6 q-pa-xs"},_e={class:"col-12 col-md-6 q-pa-xs"},be={class:"col-12"},ve={class:"pm-none",style:{display:"flex","align-items":"center"}},we={style:{"max-width":"120px","wrap-option":"warp","line-height":"0.9"}},ye={class:"pm-none"},Ce={class:"pm-none text-red text-bold text-right"},Ve={class:"pm-none"},Pe={class:"pm-none"};function Ue(a,o,g,f,n,l){return p(),q(G,{class:"q-pa-xs"},{default:r(()=>[s(b,{flat:"",bordered:""},{default:r(()=>[s(_,{class:"row items-center q-pb-none"},{default:r(()=>[o[10]||(o[10]=e("div",{class:"text-h6"},"Compras",-1)),s(c,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:o[0]||(o[0]=t=>a.$router.go(-1))})]),_:1}),s(_,{class:"q-pa-none"},{default:r(()=>[s(U,{onSubmit:l.clickDialogCompra},{default:r(()=>[e("div",T,[e("div",M,[s(V,{modelValue:n.productosSearch,"onUpdate:modelValue":[o[1]||(o[1]=t=>n.productosSearch=t),l.productosGet],outlined:"",clearable:"",label:"Buscar producto",dense:"",debounce:"300"},{append:r(()=>[s(c,{flat:"",round:"",dense:"",icon:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"]),e("div",K,[s(S,{modelValue:n.pagination.page,"onUpdate:modelValue":[o[2]||(o[2]=t=>n.pagination.page=t),l.productosGet],max:Math.ceil(n.pagination.rowsNumber/n.pagination.rowsPerPage),"max-pages":"5",size:"xs","boundary-numbers":"",class:"q-mt-sm"},null,8,["modelValue","max","onUpdate:modelValue"])]),e("div",R,[(p(!0),m(v,null,w(n.productos,t=>(p(),m("div",z,[s(b,{flat:"",bordered:"",class:"cursor-pointer",onClick:x=>l.addProducto(t)},{default:r(()=>[s(y,{src:`${a.$url}../images/${t.imagen}`,class:"q-mb-xs",style:{height:"120px"}},{default:r(()=>[e("div",L,[e("div",j,d(a.$filters.textUpper(t.nombre)),1),e("div",$,[e("span",null,d(t.stock),1),e("span",A,d(t.precio)+" Bs",1)])])]),_:2},1032,["src"])]),_:2},1032,["onClick"])]))),256))])]),e("div",O,[e("div",Z,[e("span",null,[s(c,{size:"xs",flat:"",round:"",dense:"",icon:"delete",color:"red",onClick:o[3]||(o[3]=t=>n.productosCompras=[]),class:"q-mb-sm"}),o[11]||(o[11]=e("span",{class:"text-subtitle2"},"Productos seleccionados",-1))]),e("span",null,[s(c,{size:"xs",dense:"",icon:"restore",color:"blue",class:"q-mb-sm",label:"Recuperar pedidos","no-caps":"",onClick:l.recuperarPedido},null,8,["onClick"])])]),s(P,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:r(()=>[o[13]||(o[13]=e("thead",null,[e("tr",null,[e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Producto"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Cantidad"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Precio unitario"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Total"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Factor"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Precio unitario 1.25"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Total"),e("th",{class:"pm-none",style:{"max-width":"60px","line-height":"0.9"}},"Precio venta"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Lote"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Fecha vencimiento"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Dias vencimiento")])],-1)),e("tbody",null,[(p(!0),m(v,null,w(n.productosCompras,(t,x)=>(p(),m("tr",{key:x},[e("td",H,[s(y,{src:`${a.$url}../images/${t.producto?.imagen}`,class:"q-mb-xs",style:{height:"35px",width:"35px"}},null,8,["src"]),e("div",J,[s(Q,{name:"delete",color:"red",class:"cursor-pointer",onClick:i=>n.productosCompras.splice(x,1)},null,8,["onClick"]),D(" "+d(a.$filters.textUpper(t.producto?.nombre)),1)])]),e("td",W,[u(e("input",{"onUpdate:modelValue":i=>t.cantidad=i,type:"number",style:{width:"50px"},onKeyup:i=>l.updatePrecioVenta(t),onUpdate:i=>l.updatePrecioVenta(t)},null,40,X),[[h,t.cantidad]])]),e("td",Y,[u(e("input",{"onUpdate:modelValue":i=>t.precio=i,type:"number",style:{width:"55px"},step:"0.001",onKeyup:i=>l.updatePrecioVenta(t),onUpdate:i=>l.updatePrecioVenta(t)},null,40,ee),[[h,t.precio]])]),e("td",te,d(parseFloat(t.cantidad*t.precio).toFixed(2)),1),e("td",oe,[u(e("input",{"onUpdate:modelValue":i=>t.factor=i,type:"number",style:{width:"55px"},step:"0.001",onKeyup:i=>l.updatePrecioVenta(t),onUpdate:i=>l.updatePrecioVenta(t)},null,40,ae),[[h,t.factor]])]),e("td",se,d(parseFloat(t.precio*t.factor).toFixed(2)),1),e("td",ne,d(parseFloat(t.cantidad*t.precio*t.factor).toFixed(2)),1),e("td",ie,[u(e("input",{"onUpdate:modelValue":i=>t.precio_venta=i,type:"number",style:{width:"55px",color:"red","font-weight":"bold"},step:"0.01"},null,8,le),[[h,t.precio_venta]])]),e("td",re,[u(e("input",{"onUpdate:modelValue":i=>t.lote=i,type:"text",style:{width:"70px"}},null,8,de),[[h,t.lote]])]),e("td",pe,[u(e("input",{"onUpdate:modelValue":i=>t.fecha_vencimiento=i,type:"date",style:{width:"100px"}},null,8,ce),[[h,t.fecha_vencimiento]])]),e("td",me,[e("span",{class:F(`text-bold ${new Date(t.fecha_vencimiento)-new Date<0||Math.ceil((new Date(t.fecha_vencimiento)-new Date)/(1e3*60*60*24))<30?"text-red":Math.ceil((new Date(t.fecha_vencimiento)-new Date)/(1e3*60*60*24))<60?"text-orange":"text-green"}`)},d(t.fecha_vencimiento?Math.ceil((new Date(t.fecha_vencimiento)-new Date)/(1e3*60*60*24)):""),3)])]))),128))]),e("tfoot",null,[e("tr",null,[o[12]||(o[12]=e("td",{colspan:"3",class:"text-right"},"Total",-1)),e("td",ue,d(l.totalCompra)+" Bs",1)])])]),_:1}),s(c,{label:"Registrar compra",color:"primary",class:"full-width","no-caps":"",loading:n.loading,type:"submit",icon:"add_circle_outline"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1}),s(E,{modelValue:n.compraDialog,"onUpdate:modelValue":o[9]||(o[9]=t=>n.compraDialog=t)},{default:r(()=>[s(b,{style:{width:"600px"}},{default:r(()=>[s(_,{class:"row items-center q-pb-none"},{default:r(()=>[o[14]||(o[14]=e("div",{class:"text-h6"},"Confirmar compra",-1)),s(B),s(c,{flat:"",round:"",dense:"",icon:"close",onClick:o[4]||(o[4]=t=>n.compraDialog=!1)})]),_:1}),s(_,null,{default:r(()=>[s(U,{onSubmit:l.submitCompra},{default:r(()=>[e("div",he,[e("div",ge,[s(C,{modelValue:n.proveedor,"onUpdate:modelValue":[o[5]||(o[5]=t=>n.proveedor=t),l.buscarProveedor],options:n.proveedores,"option-label":"nombre","option-value":"id",label:"Proveedor",dense:"",outlined:"",rules:[t=>!!t||"Campo requerido",t=>(t&&(this.compra.nit=t.nit,this.compra.nombre=t.nombre),!0)]},null,8,["modelValue","options","onUpdate:modelValue","rules"])]),e("div",xe,[s(C,{modelValue:n.compra.tipo_pago,"onUpdate:modelValue":o[6]||(o[6]=t=>n.compra.tipo_pago=t),options:["Efectivo","QR"],label:"Tipo de pago",dense:"",outlined:""},null,8,["modelValue"])]),e("div",fe,[s(V,{modelValue:n.compra.nro_factura,"onUpdate:modelValue":o[7]||(o[7]=t=>n.compra.nro_factura=t),outlined:"",dense:"",label:"Nro. factura"},null,8,["modelValue"])]),e("div",_e,[s(C,{modelValue:n.compra.agencia,"onUpdate:modelValue":o[8]||(o[8]=t=>n.compra.agencia=t),options:a.$agencias,label:"Agencia",dense:"",outlined:"",rules:[t=>!!t||"Campo requerido"]},null,8,["modelValue","options","rules"])]),e("div",be,[s(P,{flat:"",dense:"","wrap-cells":"",bordered:""},{default:r(()=>[o[15]||(o[15]=e("thead",null,[e("tr",null,[e("th",{class:"pm-none",style:{"max-width":"60px","wrap-option":"wrap","line-height":"0.9"}},"Producto"),e("th",{class:"pm-none",style:{"max-width":"60px","wrap-option":"wrap","line-height":"0.9"}},"Cantidad"),e("th",{class:"pm-none",style:{"max-width":"60px","line-height":"0.9"}},"Precio venta"),e("th",{class:"pm-none",style:{"max-width":"60px","wrap-option":"wrap","line-height":"0.9"}},"Lote"),e("th",{class:"pm-none",style:{"max-width":"60px","wrap-option":"wrap","line-height":"0.9"}},"Fecha vencimiento")])],-1)),e("tbody",null,[(p(!0),m(v,null,w(n.productosCompras,(t,x)=>(p(),m("tr",{key:x},[e("td",ve,[s(y,{src:`${a.$url}../images/${t.producto?.imagen}`,class:"q-mb-xs",style:{height:"35px",width:"35px"}},null,8,["src"]),e("div",we,d(a.$filters.textUpper(t.producto?.nombre)),1)]),e("td",ye,d(t.cantidad),1),e("td",Ce,d(t.precio_venta)+" Bs ",1),e("td",Ve,d(t.lote),1),e("td",Pe,d(t.fecha_vencimiento),1)]))),128))])]),_:1})])]),s(c,{label:"Guardar compra",color:"primary",class:"full-width q-mt-md",type:"submit","no-caps":"",icon:"save",loading:n.loading},null,8,["loading"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o[16]||(o[16]=e("div",{id:"myElement",class:"hidden"},null,-1))]),_:1})}const Re=k(N,[["render",Ue]]);export{Re as default};
