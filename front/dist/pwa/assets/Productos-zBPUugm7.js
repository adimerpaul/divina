import{_ as N,c as C,o as d,w as s,a as o,Q as x,e as k,b as l,f as p,aq as m,d as y,a5 as h,a6 as v,a7 as V,a8 as G,t as n,Z as c,a1 as w,at as g,h as U,au as b}from"./index-DQChmr6p.js";import{Q as $}from"./QPagination-CxQD7Ddn.js";import{Q as P,a as f,b as S}from"./QMenu-IhoyNysE.js";import{Q as A}from"./QList-BdbesaKo.js";import{Q as E,C as Q}from"./ClosePopup-BIaU1h5f.js";import{Q as K}from"./QImg-DOY6ALTi.js";import{Q as D}from"./QMarkupTable-D64y_U9g.js";import{Q as _}from"./QSpace-CizLRtMD.js";import{Q as B}from"./QForm-BVcm-P0w.js";import{Q as q}from"./QPage-rg7CFRjY.js";import"./moment-C5S46NFB.js";import{E as z}from"./Excel-DYSTQ5HC.js";import"./format-BvkBI9bc.js";import"./_commonjsHelpers-Bx2EM-6T.js";const H={name:"ProductosPage",data(){return{productos:[],producto:{},productoDialog:!1,loading:!1,actionPeriodo:"",filter:"",pagination:{page:1,rowsPerPage:15,rowsNumber:0},columns:[{name:"nombre",label:"Nombre",align:"left",field:"nombre"},{name:"precio",label:"Precio",align:"left",field:"precio"},{name:"stockAlmacen",label:"Cantidad Almacen",align:"left",field:"stockAlmacen"},{name:"stockChallgua",label:"Cantidad Challgua",align:"left",field:"stockChallgua"},{name:"stockSocavon",label:"Cantidad Socavon",align:"left",field:"stockSocavon"},{name:"stockCatalina",label:"Cantidad Catalina",align:"left",field:"stockCatalina"},{name:"barra",label:"Código de barras",align:"left",field:"barra"},{name:"stock",label:"Stock",align:"left",field:"stock"}],historialDialog:!1,historialCompras:[],productoHistorialNombre:""}},mounted(){this.productosGet(),this.debouncedCambioPrecio=b(this.cambioPrecio,500),this.debouncedCambioA=b(this.cambioStockA,500),this.debouncedCambio1=b(this.cambioStock1,500),this.debouncedCambio2=b(this.cambioStock2,500),this.debouncedCambio3=b(this.cambioStock3,500),this.debouncedCambioBarra=b(this.cambioBarra,500)},methods:{cambioStockA(a){this.loading=!0,this.$axios.put("productos/"+a.id,{stockAlmacen:a.stockAlmacen}).then(e=>{this.productosGet(),this.$alert.success("Cantidad Almacen actualizada")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},cambioStock1(a){this.loading=!0,this.$axios.put("productos/"+a.id,{stockChallgua:a.stockChallgua}).then(e=>{this.productosGet(),this.$alert.success("Cantidad Sucursal 1 actualizada")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},cambioStock2(a){this.loading=!0,this.$axios.put("productos/"+a.id,{stockSocavon:a.stockSocavon}).then(e=>{this.productosGet(),this.$alert.success("Cantidad Sucursal 2 actualizada")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},cambioStock3(a){this.loading=!0,this.$axios.put("productos/"+a.id,{stockCatalina:a.stockCatalina}).then(e=>{this.productosGet(),this.$alert.success("Cantidad Sucursal 3 actualizada")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},verHistorial(a){this.loading=!0,this.productoHistorialNombre=a.nombre,this.$axios.get(`productos/${a.id}/historial-compras`).then(e=>{this.historialCompras=e.data,this.historialDialog=!0}).catch(e=>{this.$alert.error("Error al obtener historial")}).finally(()=>{this.loading=!1})},cambioBarra(a){this.loading=!0,this.$axios.put("productos/"+a.id,{barra:a.barra}).then(e=>{this.productosGet(),this.$alert.success("Código de barras actualizado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},cambioStock(a){this.loading=!0,this.$axios.put("productos/"+a.id,{stock:a.stock}).then(e=>{this.productosGet(),this.$alert.success("Stock actualizado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},cambioPrecio(a){this.loading=!0,this.$axios.put("productos/"+a.id,{precio:a.precio}).then(e=>{this.productosGet(),this.$alert.success("Precio actualizado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},exportExcel(){this.loading=!0,this.$axios.get("productosAll").then(a=>{let e=[{columns:[{label:"Nombre",value:"nombre"},{label:"Descripción",value:"descripcion"},{label:"Unidad",value:"unidad"},{label:"Precio",value:"precio"},{label:"Stock",value:"stock"},{label:"Stock mínimo",value:"stock_minimo"},{label:"Stock máximo",value:"stock_maximo"}],content:a.data}];z.export(e,"Productos")}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},productoNew(){this.producto={name:"",email:"",password:"",area_id:1,productoname:"",cargo:"",role:"Area"},this.actionPeriodo="Nuevo",this.productoDialog=!0},productosGet(){this.loading=!0,this.$axios.get("productos",{params:{search:this.filter,page:this.pagination.page,per_page:this.pagination.rowsPerPage}}).then(a=>{this.productos=a.data.data,this.pagination.rowsNumber=a.data.total}).catch(a=>{this.$alert.error(a.response?.data?.message||"Error al cargar productos")}).finally(()=>{this.loading=!1})},gestionGet(){this.loading=!0,this.$axios.get("gestiones").then(a=>{this.gestiones=a.data,this.loading=!1}).catch(a=>{this.$alert.error(a.response.data.message),this.loading=!1})},productoPost(){this.loading=!0,this.$axios.post("productos",this.producto).then(a=>{this.productosGet(),this.productoDialog=!1,this.$alert.success("Periodo creado")}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},productoPut(){this.loading=!0,this.$axios.put("productos/"+this.producto.id,this.producto).then(a=>{this.productosGet(),this.productoDialog=!1,this.$alert.success("Periodo actualizado")}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},productoEdit(a){this.producto={...a},this.actionPeriodo="Editar",this.productoDialog=!0},productoDelete(a){this.$alert.dialog("¿Desea eliminar el producto?").onOk(()=>{this.loading=!0,this.$axios.delete("productos/"+a).then(e=>{this.productosGet(),this.$alert.success("Periodo eliminado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})})}}},I={class:"text-right"},L={class:"flex flex-center"},T={style:{"max-width":"150px","wrap-option":"wrap","line-height":"0.9"}},F=["onUpdate:modelValue","onKeyup"],M=["onUpdate:modelValue","onKeyup"],O=["onUpdate:modelValue","onKeyup"],Z=["onUpdate:modelValue","onKeyup"],j=["onUpdate:modelValue","onKeyup"],J=["onUpdate:modelValue","onKeyup"],R={class:"text-right"},W={class:"text-h6"};function X(a,e,Y,ee,i,u){return d(),C(q,{class:"q-pa-xs"},{default:s(()=>[o(x,{flat:"",bordered:""},{default:s(()=>[o(k,{class:"q-pa-xs"},{default:s(()=>[l("div",I,[o(p,{color:"primary",label:"Descargar","no-caps":"",icon:"fa-solid fa-file-excel",loading:i.loading,onClick:u.exportExcel},null,8,["loading","onClick"]),o(p,{color:"green",label:"Nuevo",onClick:u.productoNew,"no-caps":"",icon:"add_circle_outline",loading:i.loading},null,8,["onClick","loading"]),o(m,{modelValue:i.filter,"onUpdate:modelValue":[e[0]||(e[0]=t=>i.filter=t),u.productosGet],label:"Buscar",dense:"",outlined:"",debounce:"300"},{append:s(()=>[o(y,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),l("div",L,[o($,{modelValue:i.pagination.page,"onUpdate:modelValue":[e[1]||(e[1]=t=>i.pagination.page=t),u.productosGet],max:Math.ceil(i.pagination.rowsNumber/i.pagination.rowsPerPage),"rows-per-page-options":[10,25,50,100],"rows-per-page":i.pagination.rowsPerPage,"rows-number":i.pagination.rowsNumber,color:"primary","boundary-numbers":"","max-pages":"5"},null,8,["modelValue","max","rows-per-page","rows-number","onUpdate:modelValue"])]),o(D,{dense:"","wrap-cells":""},{default:s(()=>[l("thead",null,[l("tr",null,[e[13]||(e[13]=l("th",null,"Opciones",-1)),e[14]||(e[14]=l("th",null,"Imagen",-1)),(d(!0),h(v,null,V(i.columns,t=>(d(),h("th",{key:t.name,class:G(t.align)},n(t.label),3))),128))])]),l("tbody",null,[(d(!0),h(v,null,V(i.productos,t=>(d(),h("tr",{key:t.id},[l("td",null,[o(E,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:s(()=>[o(A,null,{default:s(()=>[c((d(),C(P,{clickable:"",onClick:r=>u.productoEdit(t)},{default:s(()=>[o(f,{avatar:""},{default:s(()=>[o(y,{name:"edit"})]),_:1}),o(f,null,{default:s(()=>[o(S,null,{default:s(()=>e[15]||(e[15]=[w("Editar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[Q]]),c((d(),C(P,{clickable:"",onClick:r=>u.productoDelete(t.id)},{default:s(()=>[o(f,{avatar:""},{default:s(()=>[o(y,{name:"delete"})]),_:1}),o(f,null,{default:s(()=>[o(S,null,{default:s(()=>e[16]||(e[16]=[w("Eliminar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[Q]]),c((d(),C(P,{clickable:"",onClick:r=>u.verHistorial(t)},{default:s(()=>[o(f,{avatar:""},{default:s(()=>[o(y,{name:"history"})]),_:1}),o(f,null,{default:s(()=>[o(S,null,{default:s(()=>e[17]||(e[17]=[w("Historial de compras")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[Q]])]),_:2},1024)]),_:2},1024)]),l("td",null,[o(K,{src:`${a.$url}../images/${t.imagen}`,style:{width:"50px",height:"50px"},class:"q-mr-sm"},null,8,["src"])]),l("td",null,[l("div",T,n(t.nombre),1)]),l("td",null,[c(l("input",{"onUpdate:modelValue":r=>t.precio=r,type:"number",step:"0.01",min:"0",style:{width:"55px","text-align":"right"},onKeyup:r=>a.debouncedCambioPrecio(t)},null,40,F),[[g,t.precio,void 0,{number:!0}]])]),l("td",null,[c(l("input",{"onUpdate:modelValue":r=>t.stockAlmacen=r,type:"number",step:"1",min:"0",style:{width:"50px","text-align":"right"},onKeyup:r=>a.debouncedCambioA(t)},null,40,M),[[g,t.stockAlmacen,void 0,{number:!0}]])]),l("td",null,[c(l("input",{"onUpdate:modelValue":r=>t.stockChallgua=r,type:"number",step:"1",min:"0",style:{width:"50px","text-align":"right"},onKeyup:r=>a.debouncedCambio1(t)},null,40,O),[[g,t.stockChallgua,void 0,{number:!0}]])]),l("td",null,[c(l("input",{"onUpdate:modelValue":r=>t.stockSocavon=r,type:"number",step:"1",min:"0",style:{width:"50px","text-align":"right"},onKeyup:r=>a.debouncedCambio2(t)},null,40,Z),[[g,t.stockSocavon,void 0,{number:!0}]])]),l("td",null,[c(l("input",{"onUpdate:modelValue":r=>t.stockCatalina=r,type:"number",step:"1",min:"0",style:{width:"50px","text-align":"right"},onKeyup:r=>a.debouncedCambio3(t)},null,40,j),[[g,t.stockCatalina,void 0,{number:!0}]])]),l("td",null,[c(l("input",{"onUpdate:modelValue":r=>t.barra=r,style:{width:"150px","text-align":"right"},onKeyup:r=>a.debouncedCambioBarra(t)},null,40,J),[[g,t.barra,void 0,{number:!0}]])]),l("td",null,n(t.stock),1)]))),128))])]),_:1})]),_:1})]),_:1}),o(U,{modelValue:i.productoDialog,"onUpdate:modelValue":e[10]||(e[10]=t=>i.productoDialog=t),persistent:""},{default:s(()=>[o(x,{style:{width:"400px",margin:"0 auto"}},{default:s(()=>[o(k,{class:"q-pb-none row items-center"},{default:s(()=>[l("div",null,n(i.actionPeriodo)+" producto ",1),o(_),o(p,{icon:"close",flat:"",round:"",dense:"",onClick:e[2]||(e[2]=t=>i.productoDialog=!1)})]),_:1}),o(k,{class:"q-pt-none"},{default:s(()=>[o(B,{onSubmit:e[9]||(e[9]=t=>i.producto.id?u.productoPut():u.productoPost())},{default:s(()=>[o(m,{modelValue:i.producto.nombre,"onUpdate:modelValue":e[3]||(e[3]=t=>i.producto.nombre=t),label:"Nombre",dense:"",outlined:"",rules:[t=>!!t||"Campo requerido"]},null,8,["modelValue","rules"]),o(m,{modelValue:i.producto.descripcion,"onUpdate:modelValue":e[4]||(e[4]=t=>i.producto.descripcion=t),label:"Descripción",dense:"",outlined:"",hint:""},null,8,["modelValue"]),o(m,{modelValue:i.producto.unidad,"onUpdate:modelValue":e[5]||(e[5]=t=>i.producto.unidad=t),label:"Unidad",dense:"",outlined:"",hint:""},null,8,["modelValue"]),o(m,{modelValue:i.producto.precio,"onUpdate:modelValue":e[6]||(e[6]=t=>i.producto.precio=t),label:"Precio",dense:"",outlined:"",hint:"",type:"number",step:"0.01"},null,8,["modelValue"]),o(m,{modelValue:i.producto.barra,"onUpdate:modelValue":e[7]||(e[7]=t=>i.producto.barra=t),label:"Código de barras",dense:"",outlined:"",hint:""},null,8,["modelValue"]),l("div",R,[o(p,{color:"negative",label:"Cancelar",onClick:e[8]||(e[8]=t=>i.productoDialog=!1),"no-caps":"",loading:i.loading},null,8,["loading"]),o(p,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:i.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(U,{modelValue:i.historialDialog,"onUpdate:modelValue":e[12]||(e[12]=t=>i.historialDialog=t),persistent:""},{default:s(()=>[o(x,{style:{width:"800px"}},{default:s(()=>[o(k,{class:"row items-center q-pb-none"},{default:s(()=>[l("div",W,"Historial de Compras: "+n(i.productoHistorialNombre),1),o(_),o(p,{icon:"close",flat:"",round:"",dense:"",onClick:e[11]||(e[11]=t=>i.historialDialog=!1)})]),_:1}),o(k,{class:"q-pt-none"},{default:s(()=>[o(D,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:s(()=>[e[18]||(e[18]=l("thead",null,[l("tr",null,[l("th",null,"#"),l("th",null,"Fecha"),l("th",null,"Lote"),l("th",null,"Vencimiento"),l("th",null,"Cantidad"),l("th",null,"Precio"),l("th",null,"Total")])],-1)),l("tbody",null,[(d(!0),h(v,null,V(i.historialCompras,(t,r)=>(d(),h("tr",{key:t.id},[l("td",null,n(r+1),1),l("td",null,n(t.compra?.fecha),1),l("td",null,n(t.lote),1),l("td",null,n(t.fecha_vencimiento),1),l("td",null,n(t.stock),1),l("td",null,n(t.precio),1),l("td",null,n(t.total),1)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ge=N(H,[["render",X]]);export{ge as default};
